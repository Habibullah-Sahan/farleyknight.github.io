
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Getting Started with Devise - Farley's Ruby on Rails Blog</title>
  <meta name="author" content="Farley Knight">

  
  <meta name="description" content="Before you dive in Devise is a robust authentication framework for Rails. It covers 95% of the use authentication cases you&rsquo;ll ever have &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://farleyknight.github.io/getting-started-with-devise">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Farley's Ruby on Rails Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Farley's Ruby on Rails Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:farleyknight.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Getting Started With Devise</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-02T12:17:00-04:00" pubdate data-updated="true">Sep 2<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>Before you dive in</h2>

<p>Devise is a robust authentication framework for Rails. It covers 95% of the use authentication cases you&rsquo;ll ever have working with Rails. While it&rsquo;s very robust, that robustness comes at the cost complexity. It is not recommended for absolute beginners. Moderate beginners, those of you who have used Rails for small projects and understand how authentication works, should try some sandbox projects with Devise.</p>

<p>However, if you&rsquo;re learning Ruby on Rails at the same time as programming in general, I would personally recommend that you wait until your 2nd or 3rd year of programming before you dive into Devise.</p>

<p>With that preface aside, if you feel confident enough for what&rsquo;s ahead, go ahead and start reading. If you find yourself confused or asking yourself questions about terms &amp; operations that I don&rsquo;t bother to explain, you should back up a bit and read my <a href="/basic-rails-guide">Basic Rails Guide</a>.</p>

<h2>Devise setup fast-track</h2>

<p>If you&rsquo;re looking to get set up immediately, without delay, run this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails new <span class="o">[</span>my_website<span class="o">]</span> -m http://raw.github.com/farleyknight/rails_templates/devise.rb
</span></code></pre></td></tr></table></div></figure>


<p>Finer grained detail is explained below.</p>

<h2>Devise setup, step-by-Step</h2>

<p>The following will get you the very basics for working with Devise. As with most Rails gems, you&rsquo;ll want to add the following line to your <code>Gemfile</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s2">&quot;devise&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bundle install
</span></code></pre></td></tr></table></div></figure>


<p>In your Rails root directory. This will install Devise, and all it&rsquo;s dependencies. Once installed, run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">rails</span> <span class="n">g</span> <span class="ss">devise</span><span class="p">:</span><span class="n">install</span>
</span></code></pre></td></tr></table></div></figure>


<p>This adds <code>config/initializers/devise.rb</code> to your Rails project. I provide complete details on what this file does in the <a href="/basic-devise-customization/">Basic Devise Customization</a>.</p>

<p>Come up with a descriptive name for your the &ldquo;user&rdquo; object in your project. Something simple like <code>Account</code>, <code>Admin</code>, <code>Client</code>, or even just <code>User</code> is good enough for our purposes. We&rsquo;ll assume that you&rsquo;re using User for the rest of this tutorial. Generate the <code>User</code> class by running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails g devise User
</span></code></pre></td></tr></table></div></figure>


<p>It should look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="c1"># Include default devise modules. Others available are:</span>
</span><span class='line'>  <span class="c1"># :token_authenticatable, :confirmable,</span>
</span><span class='line'>  <span class="c1"># :lockable, :timeoutable and :omniauthable</span>
</span><span class='line'>  <span class="n">devise</span> <span class="ss">:database_authenticatable</span><span class="p">,</span> <span class="ss">:registerable</span><span class="p">,</span> <span class="ss">:recoverable</span><span class="p">,</span> <span class="ss">:rememberable</span><span class="p">,</span> <span class="ss">:trackable</span><span class="p">,</span> <span class="ss">:validatable</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Each of those options to the <code>devise</code> method references a different devise module. That is covered in more detail in the <a href="/basic-devise-guide/">Basic Devise Guide</a></p>

<p>It also adds a database migration, which should look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">DeviseCreateUsers</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Migration</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">change</span>
</span><span class='line'>    <span class="n">create_table</span><span class="p">(</span><span class="ss">:users</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>      <span class="c1">## Database authenticatable</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:email</span><span class="p">,</span>              <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:encrypted_password</span><span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">## Recoverable</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">string</span>   <span class="ss">:reset_password_token</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">datetime</span> <span class="ss">:reset_password_sent_at</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">## Rememberable</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">datetime</span> <span class="ss">:remember_created_at</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">## Trackable</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">integer</span>  <span class="ss">:sign_in_count</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="mi">0</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">datetime</span> <span class="ss">:current_sign_in_at</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">datetime</span> <span class="ss">:last_sign_in_at</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">string</span>   <span class="ss">:current_sign_in_ip</span>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">string</span>   <span class="ss">:last_sign_in_ip</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">## Confirmable</span>
</span><span class='line'>      <span class="c1"># t.string   :confirmation_token</span>
</span><span class='line'>      <span class="c1"># t.datetime :confirmed_at</span>
</span><span class='line'>      <span class="c1"># t.datetime :confirmation_sent_at</span>
</span><span class='line'>      <span class="c1"># t.string   :unconfirmed_email # Only if using reconfirmable</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">## Lockable</span>
</span><span class='line'>      <span class="c1"># t.integer  :failed_attempts, :default =&gt; 0 # Only if lock strategy is :failed_attempts</span>
</span><span class='line'>      <span class="c1"># t.string   :unlock_token # Only if unlock strategy is :email or :both</span>
</span><span class='line'>      <span class="c1"># t.datetime :locked_at</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">## Token authenticatable</span>
</span><span class='line'>      <span class="c1"># t.string :authentication_token</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">add_index</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span>                <span class="ss">:unique</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>    <span class="n">add_index</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:reset_password_token</span><span class="p">,</span> <span class="ss">:unique</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'>    <span class="c1"># add_index :users, :confirmation_token,   :unique =&gt; true</span>
</span><span class='line'>    <span class="c1"># add_index :users, :unlock_token,         :unique =&gt; true</span>
</span><span class='line'>    <span class="c1"># add_index :users, :authentication_token, :unique =&gt; true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>After doing a migrate:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rake db:migrate
</span></code></pre></td></tr></table></div></figure>


<p>You should now have a <code>users</code> table in your database now. After that, you&rsquo;re pretty much good to go! Run</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails server
</span></code></pre></td></tr></table></div></figure>


<p>and you should be able to login at <code>http://localhost:3000/users/sign_up</code>.</p>

<h2>Further Setup</h2>

<p>If you need more control over how Devise works in your app, you&rsquo;re going to want to use their view generator as well. Run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails g devise:views
</span></code></pre></td></tr></table></div></figure>


<p>This adds a bunch of views under <code>app/views/devise/</code>. We can go into more detail under the <a href="/basic-devise-customization/">Basic Devise Customization</a> guide.</p>

<h3>Signing up with Facebook, Twitter, etc</h3>

<p>An often requested feature is to allow users to sign up via Facebook, Twitter, or other social network.</p>

<p>You&rsquo;ll need to add a few more gems to do this. You&rsquo;ll need to add to your Gemfile:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;devise&#39;</span> <span class="c1"># Should already be in your Gemfile</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;omniauth&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;omniauth-facebook&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>[discuss facebook integration]</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Farley Knight</span></span>

      








  


<time datetime="2013-09-02T12:17:00-04:00" pubdate data-updated="true">Sep 2<span>nd</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://farleyknight.github.io/getting-started-with-devise/" data-via="" data-counturl="http://farleyknight.github.io/getting-started-with-devise/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/common-devise-problems/" title="Next Post: Common Devise Problems">Common Devise Problems &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/awesome-rails-tools/">Awesome Rails Tools</a>
      </li>
    
      <li class="post">
        <a href="/rspec-tips/">RSpec Tips</a>
      </li>
    
      <li class="post">
        <a href="/helpful-command-line-tools/">Helpful Command Line Tools</a>
      </li>
    
      <li class="post">
        <a href="/devise-email-setup/">Devise Email Setup</a>
      </li>
    
      <li class="post">
        <a href="/basic-web-security/">Basic Web Security</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Farley Knight -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
